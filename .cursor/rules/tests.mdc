---
description: Генерация тестов
globs: 
alwaysApply: true
---
Test generation rules

- Тесты должны располагаться в директории `tests/src/`.
- Тесты это общие модули и должны быть расположены в `tests/src/CommonModules`
- Каждый тестовый модуль должен быть назван по шаблону`[Префикс типа объекта_][Имя проверяемого объект]{_Суффикс типа модуля}`, где суффикс не обязателен, но крайне желателен.

    #### Префиксы типов объекта

    | Тип тестируемого объекта | Префикс | Пример                                      |
    | ------------------------ | ------- | ------------------------------------------- |
    | Общий модуль             | `ОМ_`     | ОМ_ОбщегоНазначения                         |
    | Регистр бухгалтерии      | `РБ_`     | РБ_Хозрасчетный, РБ_Хозрасчетный_НЗ         |
    | Регистр накопления       | `РН_`     | РН_ОстаткиНаСкладах, РН_ОстаткиНаСкладах_ММ |
    | Регистр расчета          | `РР_`     | РР_Зарплата, РР_Зарплата_НЗ                 |
    | Регистр сведений         | `РС_`     | РС_АдресныйКлассификатор                    |
    | Бизнес процесс           | `БП_`     | БП_Согласование                             |
    | Справочник               | `Спр_`    | Спр_Пользователи, Спр_Пользователи_МО       |
    | План счетов              | `ПС_`     | ПС_Хозрасчетный                             |
    | План видов расчета       | `ПВР_`    | ПВР_Зарплатный                              |
    | План видов характеристик | `ПВХ_`    | ПВХ_Субконто, ПВХ_Субконто_ММ               |
    | Документ                 | `Док_`    | Док_ПКО                                     |
    | Перечисление             | `Пер_`    | Пер_СтатусСогласования                      |
    | План обмена              | `ПО_`     | ПО_РИБ, ПО_РИБ_ММ                           |
    | Задача                   | `Зад_`    | Зад_Задача                                  |
    | Обработка                | `Обр_`    | Обр_ЗакрытиеМесяца, Обр_ЗакрытиеМесяца_МО   |
    | Отчет                    | `Отч_`    | Отч_УниверсальныйОтчет                      |
    #### Суффиксы типов модулей

    | Тип тестируемого модуля | Суффикс        | Пример                                     |
    | ----------------------- | -------------- | ------------------------------------------ |
    | Общий модуль            | `<Без суффикса>` | ОМ_ОбщегоНазначения                        |
    | Модуль объекта          | `_МО`            | Спр_Пользователи_МО, Обр_ЗакрытиеМесяца_МО |
    | Модуль менеджера        | `_ММ`            | ПВХ_Субконто_ММ, ПО_РИБ_ММ                 |
    | Модуль набора записей   | `_НЗ`            | РБ_Хозрасчетный_НЗ, РР_Зарплата_НЗ         |
    Примеры: Для документа `ПоступлениеДенег` тестовый модуль будет иметь имя `Док_ПоступлениеДенег` и будет располагатся `tests/src/CommonModules/Док_ПоступлениеДенег/Module.bsl`
- Для тестового модуля необходимо
    - Создать каталог `tests/src/CommonModules/[Имя модуля]`
    - Создать описание `tests/src/CommonModules/[Имя модуля]/[Имя модуля].mdo` как и любого другого общего модуля
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <mdclass:CommonModule xmlns:mdclass="http://g5.1c.ru/v8/dt/metadata/mdclass" uuid="GeneratedGUID">
    <name>[Имя модуля]</name>
    <clientManagedApplication>true</clientManagedApplication>
    <server>true</server>
    <clientOrdinaryApplication>true</clientOrdinaryApplication>
    </mdclass:CommonModule>
    ```
      - Вместо GeneratedGUID необходимо создать новый guid
      - для модулей объектов и менеджеров <server>true</server> остальные false
      - для общих модулей флаги clientManagedApplication, server и clientOrdinaryApplication в соответствии с настройками проверяемого модуля
    - Создать тестовый модуль `tests/src/CommonModules/[Имя модуля]/Module.bsl`
    - Зарегистрировать в конфигурации tests/src/Configuration/Configuration.mdo
- Тест состоит из обязательных частей:
    - Регистрация в методе `ИсполняемыеСценарии`
    - При регистрации используй fluent интерфейс
    - Реализация теста
- Доступна обработка событий, обработчики это экспортные процедуры без параметров
    - ПередВсемиТестами
    - ПередТестовымНабором
    - ПередКаждымТестом
    - ПослеКаждогоТеста
    - ПослеТестовогоНабора
    - ПослеВсехТестов
- пример
Процедура ИсполняемыеСценарии() Экспорт
    
    // Регистрация тестов
    ЮТТесты // Регистрация тестов выполняет через модуль регистратор
        .ДобавитьТестовыйНабор("Математические методы")               // Набор - объединение тестов
            .ДобавитьТест("Сложение")                                 // Обязательно при регистрации указываем имя экспортного метода
            .ДобавитьТест("Вычитание", "Вычитание")                   // Также можно указать представление теста
            .ДобавитьТест("Вычитание", "ВычитаниеСервер", , "Сервер") // Контекст исполнения, по умолчанию тест выполняется во всех контекстах модуля
            .ДобавитьКлиентскийТест("УмножениеНаКлиенте")                   // Есть отдельный метод для регистрации клиентских тестов
            .ДобавитьСерверныйТест("ДелениеНаСервере", "Деление на сервер") // Есть отдельный метод для регистрации серверных тестов
        .ДобавитьТестовыйНабор("Строковые методы")
            .ДобавитьТест("СтрНайти")
            .ДобавитьТест("СтрРазделить");

КонецПроцедуры

Процедура Сложение() Экспорт
    // Тест сложения
КонецПроцедуры